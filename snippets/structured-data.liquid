{% comment %}Organization{% endcomment %}
{%- if request.page_type == 'index' -%}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      {%- assign organization_name = 'structured_data.organization.name' | t %}
      "name": {% if organization_name != "" %}{{ organization_name | json}}{% else %}{{ shop.name | json }}{% endif %},
      "url": {{ shop.url | append: page.url | json }},
      {% if 'structured_data.organization.slogan' %}"slogan": {{ 'structured_data.organization.slogan' | t | json}},{% endif %}
      {% if settings.struc_data_orga_logo -%}
        "logo": {
          "@type": "ImageObject",
          "url" : {{ settings.struc_data_orga_logo | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
          "contentUrl": {{ settings.struc_data_orga_logo | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
          "width": {{ settings.struc_data_orga_logo.width | json }},
          "height": {{ settings.struc_data_orga_logo.height | json }}
          {%- if settings.struc_data_orga_logo.alt -%}, "caption": {{ settings.struc_data_orga_logo.alt | json }}{% endif %}
        },  
      {% elsif section.settings.logo %}
        {% assign image_size = section.settings.logo.width | append: 'x' %}
        "logo": {{ section.settings.logo | img_url: image_size | prepend: "https:" | json }},
      {% endif %}
      "sameAs": [
        {%- if settings.social_facebook_link != ""  %} {{ settings.social_facebook_link | json }},{% endif %}
        {%- if settings.social_twitter_link != "" %} {{ settings.social_twitter_link | json }},{% endif %}
        {%- if settings.social_pinterest_link != ""  %} {{ settings.social_pinterest_link | json }},{% endif %}
        {%- if settings.social_tiktok_link != ""  %} {{ settings.social_tiktok_link | json }},{% endif %}
        {%- if settings.social_tumblr_link != ""  %} {{ settings.social_tumblr_link | json }},{% endif %}
        {%- if settings.social_snapchat_link != "" %} {{ settings.social_snapchat_link | json }},{% endif %}
        {%- if settings.social_youtube_link != "" %} {{ settings.social_youtube_link | json }},{% endif %}
        {%- if settings.social_vimeo_link != "" %} {{ settings.social_vimeo_link | json }},{% endif %}
        {%- if settings.social_instagram_link != "" %} {{ settings.social_instagram_link | json }}{% endif %}
      ],
      {% if settings.struc_data_founding_date != ""  %}"foundingDate": {{ settings.struc_data_founding_date | json }},{% endif %}
      "founders":[
        {
          "@type": "Person",
          "name": {{ settings.struc_data_founder_1 | json }}
        },
        {
          "@type": "Person",
          "name": {{ settings.struc_data_founder_2 | json }}
        }
      ],
      "address": {
        "@type": "PostalAddress",
        "streetAddress": {{ 'structured_data.organization.street' | t | json }},
        "postalCode": {{ settings.struc_data_postal_code | json }},
        "addressLocality": {{ 'structured_data.organization.city' | t | json }},   
        "addressCountry": {
          "@type": "Country",
          "name": {{ settings.struc_data_address_country | json }}
        }
      },
      "brand": {
        "@type": "Brand",
        {% if settings.struc_data_brand_logo -%}
          "logo": {
            "@type": "ImageObject",
            "url" : {{ settings.struc_data_brand_logo | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
            "contentUrl": {{ settings.struc_data_brand_logo | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
            "width": {{ settings.struc_data_brand_logo.width | json }},
            "height": {{ settings.struc_data_brand_logo.height | json }}
            {%- if settings.struc_data_brand_logo.alt -%}, "caption": {{ settings.struc_data_brand_logo.alt | json }}{% endif %}
          },
        {% endif %}
        {% if 'structured_data.brand.name' %}"name": {{ 'structured_data.brand.name' | t | json}},{% endif %}
        {% if 'structured_data.brand.slogan' %}"slogan": {{ 'structured_data.brand.slogan' | t | json}},{% endif %}
        {% if 'structured_data.brand.description' %}"description": {{ 'structured_data.brand.description' | t | json}},{% endif %}
        {% if settings.struc_data_brand_image -%}
          "image": {
            "@type": "ImageObject",
            "url" : {{ settings.struc_data_brand_image | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
            "contentUrl": {{ settings.struc_data_brand_image | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
            "width": {{ settings.struc_data_brand_image.width | json }},
            "height": {{ settings.struc_data_brand_image.height | json }}
            {%- if settings.struc_data_brand_image.alt != "" -%}, "caption": {{ settings.struc_data_brand_image.alt | json }}{% endif %}
          },
        {% endif %}
        "sameAs": [
          {%- if settings.social_facebook_link != ""  %} {{ settings.social_facebook_link | json }},{% endif %}
          {%- if settings.social_twitter_link != "" %} {{ settings.social_twitter_link | json }},{% endif %}
          {%- if settings.social_pinterest_link != ""  %} {{ settings.social_pinterest_link | json }},{% endif %}
          {%- if settings.social_tiktok_link != ""  %} {{ settings.social_tiktok_link | json }},{% endif %}
          {%- if settings.social_tumblr_link != ""  %} {{ settings.social_tumblr_link | json }},{% endif %}
          {%- if settings.social_snapchat_link != "" %} {{ settings.social_snapchat_link | json }},{% endif %}
          {%- if settings.social_youtube_link != "" %} {{ settings.social_youtube_link | json }},{% endif %}
          {%- if settings.social_vimeo_link != "" %} {{ settings.social_vimeo_link | json }},{% endif %}
          {%- if settings.social_instagram_link != "" %} {{ settings.social_instagram_link | json }}{% endif %}
        ],
        "url": {{ shop.url | append: page.url | json }}
      },
      {%- if settings.struc_data_email != ""  %}"email": {{ settings.struc_data_email | json }},{% endif %}
      {%- if shop.address.company != ""  %}"legalName": {{ shop.address.company | json }},{% endif %}
      {%- if settings.struc_data_telephone != ""  %}"telephone": {{ settings.struc_data_telephone | json }},{% endif %}
      {%- assign organization_description = 'structured_data.organization.description' | t %}
      "description": {% if organization_description != "" %}{{ organization_description | json}}{% else %}{{ shop.description | json }}{% endif %},
      {%- assign organization_knows_about = 'structured_data.organization.knows_about' | t %}
      {% if organization_knows_about != "" %}"knowsAbout": {{ organization_description | json}}{% endif %}
      {% if settings.struc_data_orga_image %}
        , "image": {
          "@type": "ImageObject",
          "url" : {{ settings.struc_data_orga_image | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
          "contentUrl": {{ settings.struc_data_orga_image | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
          "width": {{ settings.struc_data_orga_image.width | json }},
          "height": {{ settings.struc_data_orga_image.height | json }}
          {%- if settings.struc_data_orga_image.alt != "" -%}, "caption": {{ settings.struc_data_orga_image.alt | json }}{% endif %}
        }
      {% endif %}   
    }   
  </script>
{%- endif -%}

{% comment %}WebSite{% endcomment %}
{%- if request.page_type == 'index' -%}
  {% assign potential_action_target = shop.url | append: routes.search_url | append: "?q={search_term_string}" %}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      },
      "url": {{ shop.url | append: page.url | json }}
    }
  </script>
{%- endif -%}

{% comment %}
  Breadcrumbs
  https://developers.google.com/search/docs/advanced/structured-data/breadcrumb
{% endcomment %}

{% if collection.url == blank %}
  {% assign collection_url = '/collections/all' %}
{% else %}
  {% assign collection_url = collection.url %}
{% endif %}

{% if template.name == 'product' 
    or template.name == 'list-collections' 
    or template.name == 'collection' 
    or template.name == 'blog' 
    or template.name == 'article' 
    or template.name == 'search' 
    or template.name == 'cart' 
    or template.name == 'page'
%}
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {% case template.name %}
          {% when 'product' %}
            {%- if product.collections.size >= 1 -%}
              {%- assign product_handles = "" | split: ',' -%}
              {%- assign collection_handles = "" | split: ',' -%}
              
              {%- assign product_collection_handles_array = settings.product_collection_handles | newline_to_br | strip_newlines | split: '<br />' -%}
              {%- for product_collection_handles in product_collection_handles_array -%}
                {%- assign handles = product_collection_handles | split: ':' -%}
                {%- assign product_handle = handles[0] | strip | split: ',' -%}
                {%- assign collection_handle = handles[1] | strip | split: ',' -%}
              
                {%- assign product_handles = product_handles | concat: product_handle -%}
                {%- assign collection_handles = collection_handles | concat: collection_handle -%}
              {%- endfor -%}

              {%- assign product_handle = product.handle -%}
              {%- assign position = -1 -%}
              {%- for handle in product_handles -%}
                {%- if handle == product_handle -%}
                  {%- assign position = forloop.index0 -%}
                  {%- break -%}
                {%- endif -%}
              {%- endfor -%}
              {%- if position > -1 -%}
                {%- assign collection_handle = collection_handles[position] -%}
                {% if collections[collection_handle] != blank %}
                  {
                    "@type": "ListItem",
                    "position": 1,
                    "item": "{{ shop.url }}/collections/{{ collection_handle }}",
                    "name": {{ collections[collection_handle].title | json }}
                  },
                {% endif %}
              {%- endif -%}
            {%- endif -%}
            
            {%- if product.metafields.seo.struc_data_title != blank -%}
              {%- assign name = product.metafields.seo.struc_data_title.value -%}
            {%- else -%}
              {%- assign name = product.title -%}
            {%- endif -%}
            {
              "@type": "ListItem",
              "position": {% if product.collections.size >= 1 and position > -1 and collections[collection_handle] != blank %}2{% else %}1{% endif %},
              "item": "{{ shop.url }}{{ product.url | within: collection }}",
              "name": {{ name | json }}
            }
          {% when 'list-collections' %}
            {
              "@type": "ListItem",
              "position": 1,
              "item": "{{ shop.url }}/collections",
              "name": {{ 'structured_data.breadcrumbs.collections' | t | json }}
            }
          {% when 'collection' %}
            {
              "@type": "ListItem",
              "position": 1,
              "item": "{{ shop.url }}{{ collection_url }}",
              "name": {{ collection.title | json }}
            }
          {% when 'blog' or 'article' %}
            {
              "@type": "ListItem",
              "position": 1,
              "item": "{{ shop.url }}{{ blog.url }}",
              "name": {{ blog.title | json }}
            }
            {% if template.name == 'article' %}
              ,
              {
                "@type": "ListItem",
                "position": 2,
                "item": "{{ shop.url }}{{ article.url }}",
                "name": {{ article.title | json }}
              }
            {% endif %}
          {% when 'search' %}
            {
              "@type": "ListItem",
              "position": 1,
              "item": "{{ shop.url }}/search",
              "name": {{ 'structured_data.breadcrumbs.search' | t | json }}
            }
            {% if search.performed %}
              {
                "@type": "ListItem",
                "position": 2,
                "item": "{{ shop.url }}/search?q={{ search.terms }}",
                "name": {{ search.terms | json }}
              }
              {% if current_page != 1 %}
                {
                  "@type": "ListItem",
                  "position": 3,
                  "item": "{{ shop.url }}/search?page={{ current_page }}&q={{ search.terms }}",
                  "name": {{ 'structured_data.breadcrumbs.page' | t: page: current_page | json }}
                }
              {% endif %}
            {% endif %}
          {% when 'cart' %}
            {
              "@type": "ListItem",
              "position": 1,
              "item": "{{ shop.url }}/cart",
              "name": {{ 'structured_data.breadcrumbs.cart' | t | json }}
            }
          {% when 'page' %}
            {%- if page.metafields.seo.struc_data_breadcrumb_prev_page != blank -%}
              {%- assign page_handles = "" | split: ',' -%}
              {%- assign handle = page.handle | split: ',' -%}
              {%- assign page_handles = page_handles | concat: handle -%}
              {%- render 'page-struc-data-breadcrumb', page_handles: page_handles, pg: page -%}
            {%- else -%}
              {%- if page.metafields.seo.struc_data_breadcrumb_name != blank -%}
                {%- assign name = page.metafields.seo.struc_data_breadcrumb_name.value -%}
              {%- else -%}
                {%- assign name = page.title -%}
              {%- endif -%}
              {
                "@type": "ListItem",
                "position": 1,
                "item":"{{ shop.url }}{{ page.url }}",
                "name": {{ name | json }}
              }
            {%- endif -%}
          {% else %}
        {% endcase %}
      ]
    }
  </script>
{% endif %}

{% comment %}CollectionPage{% endcomment %}
{% if template.name == 'collection' %}
  <script type="application/ld+json">
    {%- if collection.metafields.seo.struc_data_name != blank -%}
      {%- assign name = collection.metafields.seo.struc_data_name.value -%}
    {%- else -%}
      {%- assign name = collection.title -%}
    {%- endif -%}
    {%- if collection.metafields.seo.struc_data_description != blank -%}
      {%- assign description = collection.metafields.seo.struc_data_description.value -%}
    {%- else -%}
      {%- assign description = collection.description -%}
    {%- endif -%}
    {
      "@context": "http://schema.org",
      "@type": "ItemList",
      "mainEntityOfPage": {
        "@type": "CollectionPage",
        "@id": {{ shop.url | append: collection_url | json }},
        "name": {{ name | json }},
        "description": {{ description | json }},
        "image": [
          {% if collection.metafields.seo.struc_data_img != blank %}
            {% for img in collection.metafields.seo.struc_data_img.value %}
              {{ img | img_url: 'master' | split:'?' | first | prepend: "https:" | json }}{%- unless forloop.last -%},{%- endunless -%}
            {% endfor %}
          {% else %}
            {{ collection.image | img_url: 'master' | split:'?' | first | prepend: "https:" | json }}
          {% endif %}
        ],
        "url": {{ shop.url | append: collection_url | json }}
      },
      "itemListElement": [
        {%- for product in collection.products -%}
          {
            "@type": "ListItem",
            "position": {{ forloop.index }},
            "url": {{ shop.url | append: product.url | json }}
          }{%- unless forloop.last -%},{%- endunless -%}
        {%- endfor -%}
      ]
    }
  </script>
{% endif %}

{% comment %}Article{% endcomment %}
{% if template.name == 'page' %}
{%- if page.metafields.details.page_type == "content" -%}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Article",
      "headline": {{ page.metafields.global.title_tag | json }},      
      "datePublished": {{ page.published_at | date: '%Y-%m-%dT%H:%M:%SZ' | json }},
      {%- if page.metafields.seo.struc_data_thumbnail -%}
        "thumbnailUrl": {{ page.metafields.seo.struc_data_thumbnail.value | split:'?' | first | prepend: "https:" | json }},
      {%- endif -%}
      {% if page.metafields.seo.struc_data_breadcrumb_prev_page != blank %}
        {% assign previous_page = page.metafields.seo.struc_data_breadcrumb_prev_page.value %}
        {% if pages[previous_page.handle].metafields.seo.struc_data_breadcrumb_name != blank %}
          "articleSection": {{ pages[previous_page.handle].metafields.seo.struc_data_breadcrumb_name.value | json }},
        {% endif %}
      {% endif %}
      "author": {
        {% if page.metafields.author.name %}
          "name": {{ page.metafields.author.name | json }},
        {% endif %}
        {% if page.metafields.author.description %}
          "description": {{ page.metafields.author.description | json }},
        {% endif %}
        {% if page.metafields.author.url %}
          "url": {{ shop.url | append: page.metafields.author.url.value.url | json }},
        {% endif %}
        "@type": "Person"
      },
      "inLanguage": {{ request.locale.iso_code | json }},
      "publisher": {
        "@type": "Organization",
        {%- assign organization_name = 'structured_data.organization.name' | t %}
        "name": {% if organization_name != "" %}{{ organization_name | json}}{% else %}{{ shop.name | json }}{% endif %},
        "url": {{ shop.url | append: page.url | json }},
        {% if 'structured_data.organization.slogan' %}"slogan": {{ 'structured_data.organization.slogan' | t | json}},{% endif %}
        {% if settings.struc_data_orga_logo -%}
          "logo": {
            "@type": "ImageObject",
            "url" : {{ settings.struc_data_orga_logo | split:'?' | first | prepend: "https:" | json }},
            "contentUrl": {{ settings.struc_data_orga_logo | split:'?' | first | prepend: "https:" | json }},
            "width": {{ settings.struc_data_orga_logo.width | json }},
            "height": {{ settings.struc_data_orga_logo.height | json }}
            {%- if settings.struc_data_orga_logo.alt -%}, "caption": {{ settings.struc_data_orga_logo.alt | json }}{% endif %}
          },  
        {% elsif section.settings.logo %}
          {% assign image_size = section.settings.logo.width | append: 'x' %}
          "logo": {{ section.settings.logo | img_url: image_size | prepend: "https:" | json }},
        {% endif %}
        "sameAs": [
          {%- if settings.social_facebook_link != ""  %} {{ settings.social_facebook_link | json }},{% endif %}
          {%- if settings.social_twitter_link != "" %} {{ settings.social_twitter_link | json }},{% endif %}
          {%- if settings.social_pinterest_link != ""  %} {{ settings.social_pinterest_link | json }},{% endif %}
          {%- if settings.social_tiktok_link != ""  %} {{ settings.social_tiktok_link | json }},{% endif %}
          {%- if settings.social_tumblr_link != ""  %} {{ settings.social_tumblr_link | json }},{% endif %}
          {%- if settings.social_snapchat_link != "" %} {{ settings.social_snapchat_link | json }},{% endif %}
          {%- if settings.social_youtube_link != "" %} {{ settings.social_youtube_link | json }},{% endif %}
          {%- if settings.social_vimeo_link != "" %} {{ settings.social_vimeo_link | json }},{% endif %}
          {%- if settings.social_instagram_link != "" %} {{ settings.social_instagram_link | json }}{% endif %}
        ],
        {% if settings.struc_data_founding_date != ""  %}"foundingDate": {{ settings.struc_data_founding_date | json }},{% endif %}
        "founders":[
          {
            "@type": "Person",
            "name": {{ settings.struc_data_founder_1 | json }}
          },
          {
            "@type": "Person",
            "name": {{ settings.struc_data_founder_2 | json }}
          }
        ],
        "address": {
          "@type": "PostalAddress",
          "streetAddress": {{ 'structured_data.organization.street' | t | json }},
          "postalCode": {{ settings.struc_data_postal_code | json }},
          "addressLocality": {{ 'structured_data.organization.city' | t | json }},   
          "addressCountry": {
            "@type": "Country",
            "name": {{ settings.struc_data_address_country | json }}
          }
        },
        "brand": {
          "@type": "Brand",
          "logo": {
            "@type": "ImageObject",
            "url" : {{ settings.struc_data_brand_logo | split:'?' | first | prepend: "https:" | json }},
            "contentUrl": {{ settings.struc_data_brand_logo | split:'?' | first | prepend: "https:" | json }},
            "width": {{ settings.struc_data_brand_logo.width | json }},
            "height": {{ settings.struc_data_brand_logo.height | json }}
            {%- if settings.struc_data_brand_logo.alt -%}, "caption": {{ settings.struc_data_brand_logo.alt | json }}{% endif %}
          },
          {% if 'structured_data.brand.name' %}"name": {{ 'structured_data.brand.name' | t | json}},{% endif %}
          {% if 'structured_data.brand.slogan' %}"slogan": {{ 'structured_data.brand.slogan' | t | json}},{% endif %}
          {% if 'structured_data.brand.description' %}"description": {{ 'structured_data.brand.description' | t | json}},{% endif %}


          {% if settings.struc_data_brand_image -%}
            , "image": {
              "@type": "ImageObject",
              "url" : {{ settings.struc_data_brand_image | split:'?' | first | prepend: "https:" | json }},
              "contentUrl": {{ settings.struc_data_brand_image | split:'?' | first | prepend: "https:" | json }},
              "width": {{ settings.struc_data_brand_image.width | json }},
              "height": {{ settings.struc_data_brand_image.height | json }}
              {%- if settings.struc_data_brand_image.alt != "" -%}, "caption": {{ settings.struc_data_brand_image.alt | json }}{% endif %}
            }
          {% endif %}
          "sameAs": [
            {%- if settings.social_facebook_link != ""  %} {{ settings.social_facebook_link | json }},{% endif %}
            {%- if settings.social_twitter_link != "" %} {{ settings.social_twitter_link | json }},{% endif %}
            {%- if settings.social_pinterest_link != ""  %} {{ settings.social_pinterest_link | json }},{% endif %}
            {%- if settings.social_tiktok_link != ""  %} {{ settings.social_tiktok_link | json }},{% endif %}
            {%- if settings.social_tumblr_link != ""  %} {{ settings.social_tumblr_link | json }},{% endif %}
            {%- if settings.social_snapchat_link != "" %} {{ settings.social_snapchat_link | json }},{% endif %}
            {%- if settings.social_youtube_link != "" %} {{ settings.social_youtube_link | json }},{% endif %}
            {%- if settings.social_vimeo_link != "" %} {{ settings.social_vimeo_link | json }},{% endif %}
            {%- if settings.social_instagram_link != "" %} {{ settings.social_instagram_link | json }}{% endif %}
          ],
          "url": {{ shop.url | append: page.url | json }}
        },
        {%- if settings.struc_data_email != ""  %}"email": {{ settings.struc_data_email | json }},{% endif %}
        {%- if shop.address.company != ""  %}"legalName": {{ shop.address.company | json }},{% endif %}
        {%- if settings.struc_data_telephone != ""  %}"telephone": {{ settings.struc_data_telephone | json }},{% endif %}
        {%- assign organization_description = 'structured_data.organization.description' | t %}
        "description": {% if organization_description != "" %}{{ organization_description | json}}{% else %}{{ shop.description | json }}{% endif %},
        {%- assign organization_knows_about = 'structured_data.organization.knows_about' | t %}
        {% if organization_knows_about != "" %}"knowsAbout": {{ organization_description | json}}{% endif %}
        {% if settings.struc_data_orga_image %}
          , "image": {
            "@type": "ImageObject",
            "url" : {{ settings.struc_data_orga_image | split:'?' | first | prepend: "https:" | json }},
            "contentUrl": {{ settings.struc_data_orga_image | split:'?' | first | prepend: "https:" | json }},
            "width": {{ settings.struc_data_orga_image.width | json }},
            "height": {{ settings.struc_data_orga_image.height | json }}
            {%- if settings.struc_data_orga_image.alt != "" -%}, "caption": {{ settings.struc_data_orga_image.alt | json }}{% endif %}
          }
        {% endif %}
      },
      "image": [
        {% if page.metafields.seo.struc_data_img %}
          {% for img in page.metafields.seo.struc_data_img.value %}
            {
              "@type": "ImageObject",
              "url" : {{ img | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
              "contentUrl": {{ img | img_url: 'master' | split:'?' | first | prepend: "https:" | json }},
              "width": {{ img.width | json }},
              "height": {{ img.height | json }}
              {%- if img.alt != "" -%}, "caption": {{ img.alt | json }}{% endif %}               
            }{%- unless forloop.last -%},{%- endunless -%}
          {% endfor %}
        {% endif %}
      ],
      "description": {{ page.metafields.global.description_tag | json }}
    }
  </script>
{%- endif -%}
{% endif %}
